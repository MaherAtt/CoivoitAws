<!DOCTYPE html>
<html lang="fr">
    <head>
        <%- include('./partials/head'); -%>
    </head>
    <body>
        <%- include('./partials/header'); -%>     
        <div id="messagerie" class="col-md-12 row">
            <h1 class="col-sm-12 col-md-12 text-center titre_page">Messagerie</h1>

            <form>
                <input type="text" id="username" placeholder="Votre pseudonyme"><br />
                <textarea id="message" placeholder="Votre message"></textarea><br />
                <input type="submit" id="submit">
            </form>

            <div id="response"></div>

            <ul id="messages" style="list-style:none;"></ul>

            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
            <!--                    <script src="/socket.io/socket.io.js"></script>-->
            <script>
                /*function XSSPatcher(texte){
                            return texte
                                .replace(/&/g, "&amp;")
                                .replace(/</g, "&lt;")
                                .replace(/>/g, "&gt;")
                                .replace(/"/g, "&quot;")
                                .replace(/'/g, "&&#039;")
                        }
                        $(document).ready(function(){
                            let socket = io();
                            $('#submit').on('click', function(e){
                                e.preventDefault();

                                let data = {
                                    username: $('#username').val(),
                                    message : $('#message').val()
                                };

                                socket.emit('new message', data);
                            });

                            socket.on('error message', function(phrase){
                                $('#response').html(phrase);
                            });

                            socket.on('new message', function(data){
                                $('#messages').append('<li>' + XSSPatcher(data.username) + ' : ' + XSSPatcher(data.message) + '</li>');
                            });

                            socket.on('last message', function(arr){
                                for(i = 0;i < arr.length;i++){
                                    $("#messages").append('<li>' + XSSPatcher(arr[i]) + '</li>');
                                }
                            });

                        });*/
            </script>

        </div>



        <%- include('./partials/menu'); -%>
        <%- include('./partials/footer'); -%>
    </body></html>
